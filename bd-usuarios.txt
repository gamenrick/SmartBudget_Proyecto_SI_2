DROP DATABASE IF EXISTS smartbudget;
CREATE DATABASE smartbudget;
USE smartbudget;

CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre_usuario VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    contrasena VARCHAR(255) NOT NULL
);

DELIMITER $$
CREATE PROCEDURE ReordenarIDs()
BEGIN
    CREATE TEMPORARY TABLE temp_users AS
    SELECT nombre_usuario, email, contrasena
    FROM usuarios
    ORDER BY id;

    DELETE FROM usuarios;
    ALTER TABLE usuarios AUTO_INCREMENT = 1;

    INSERT INTO usuarios (nombre_usuario, email, contrasena)
    SELECT nombre_usuario, email, contrasena FROM temp_users;

    DROP TEMPORARY TABLE temp_users;
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER after_user_delete
AFTER DELETE ON usuarios
FOR EACH ROW
BEGIN
    CALL ReordenarIDs();
END$$
DELIMITER ;
